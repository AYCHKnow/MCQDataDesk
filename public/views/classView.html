<script src="../controllers/classViewController.js"></script>

<div id="classContainer" ng-controller="classViewCtrl">
    <nav class="navbar navbar-masthead navbar-default" style="margin-bottom:0">
        <div class="container-fluid" style="padding-left:0">
            <div class="collapse navbar-collapse bs-example-masthead-collapse-1">
                <!-- Left Elements -->
                <ul class="nav navbar-nav">
                    <li class="active"><a class="navbar-brand">{{ class.courseID }}</a></li>
                    <li><a href="#" ng-click="goBack()">Course Selection</a></li>
                    <li><a href="#" ng-click="about()">About</a></li>
                </ul>
                <!-- Right Elements -->
                <ul class="nav navbar-nav navbar-right">
                    <li class="dropdown" uib-dropdown>
                        <a href="#" class="dropdown-toggle" uib-dropdown-toggle>Course Tools <span class="caret"></span></a>
                        <ul class="dropdown-menu" uib-dropdown-menu>
                            <li><a href="#" ng-click="importQuestions()">Import Questions</a></li>
                            <li><a href="#" ng-click="exportAssessment()">Export Assessment</a></li>
                            <li role="separator" class="divider"></li>
                            <li tooltip-placement="left" uib-tooltip="Use this if the questions listed under specific objectives are wrong (or acting funny).">
                                <a href="#" ng-click="repairObjectives()">Repair Objective Relationships</a>
                            </li>
                        </ul>
                    </li>
                    <li><a ng-click="settings()" href="#">Settings</a></li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Overview Tab-->
    <div ng-show="currentTab === 0">
        <div autoscroll="55">
            <div class="padding greyBackground">
                <uib-tabset justified="true" active="classView.openedTab">
                    <!-- Assessments Tab -->
                    <uib-tab index="0" context-menu="assessmentsHeading">
                        <uib-tab-heading>
                            Assessments  ({{ class.assessments.length }})
                        </uib-tab-heading>

                        <div class="tab-pane" style="padding:5px;background:white;border:1px solid #ddd;border-top-color:white;border-radius:0 0 4px 4px">
                            <div class="container-fluid" style="padding-bottom:5px">
                                <div id="assessmentFloatingButtons" style="padding-bottom:5px;">
                                    <div class="btn-group btn-group-sm" role="group">
                                        <button type="button" class="btn btn-primary" ng-click="createAssessment()">Create New</button>
                                        <button type="button" class="btn btn-default" ng-disabled="!class.assessments.length" ng-click="iterateAccordion('assessment',true)">Expand All</button>
                                        <button type="button" class="btn btn-default" ng-disabled="!class.assessments.length" ng-click="iterateAccordion('assessment',false)">Collapse All</button>
                                    </div>

                                    <div class="btn-group btn-group-sm" style="float:right;position:relative;top:6px;display:flex">
                                        <ui-select ng-model="sortModels.assessments" theme="bootstrap" search-enabled="false" uib-tooltip="Sorting Mode" style="width:190px">
                                            <ui-select-match style="height:30px;border-bottom-right-radius:0;border-top-right-radius:0;border-right:0">
                                                <span class="glyphicon" ng-class="$select.selected.icon" style="width:14px;left:-5px;font-size:12px"></span>{{$select.selected.name}}
                                            </ui-select-match>
                                            <ui-select-choices repeat="sort in sortModes">
                                                {{ sort.name }}
                                            </ui-select-choices>
                                        </ui-select>
                                        <button type="button" ng-class="'btn btn-default'+(classView.assessments.bulk.open?' active':'')" data-toggle="button" tooltip-placement="top"
                                                uib-tooltip="Bulk Operations" ng-click="classView.assessments.bulk.open = !classView.assessments.bulk.open;">
                                            <span class="glyphicon glyphicon-check"></span>
                                        </button>
                                        <button type="button" ng-class="'btn btn-default'+(classView.assessments.filter.open?' active':'')" data-toggle="button"
                                                tooltip-placement="top" uib-tooltip="Filter" ng-click="classView.assessments.filter.open = !classView.assessments.filter.open;focusId('filterAssessmentSearch')">
                                            <span class="glyphicon glyphicon-filter"></span>
                                        </button>
                                    </div>
                                </div>

                                <!-- Filter Dropdown -->
                                <div ng-if="classView.assessments.filter.open">
                                    <div style="padding: 5px;background-color:#e7e7e7;border:1px solid rgb(205, 205, 205);display:flex; flex-flow:row wrap;">
                                        <div class="input-group" style="width:65%;margin-right:2px;display:inline-flex;flex:1 1 auto">
                                            <input type="text" class="form-control" placeholder="Filter Assessments" id="filterAssessmentSearch" ng-model="classView.assessments.filter.query" style="flex:1 1 auto;">
                                            <span class="input-group-addon" style="min-width:45%;white-space:normal;flex:1 1 auto;">
                                                    <label>
                                                        <input type="checkbox" ng-model="classView.assessments.filter.searchNames" style="position:relative;top:2px"/>
                                                        Search Names
                                                    </label>

                                                    <label>
                                                        <input type="checkbox" ng-model="classView.assessments.filter.searchDescriptions" style="position:relative;top:2px"/>
                                                        Search Descriptions
                                                    </label>

                                                    <label>
                                                        <input type="checkbox" ng-model="classView.assessments.filter.searchQuestions" style="position:relative;top:2px"/>
                                                        Search Questions
                                                    </label>

                                                    <label>
                                                        <input type="checkbox" ng-model="classView.assessments.filter.caseSensitive" style="position:relative;top:2px"/>
                                                        Case Sensitive
                                                    </label>
                                                </span>
                                        </div>
                                        <div style="width:34.8%; display:inherit;flex:1 1 auto;overflow-x:auto">
                                            <div class="input-group" style="width:49%;margin-right:2px">
                                                <ui-select append-to-body="true" allow-clear ng-model="assessmentsQuery.topic" theme="bootstrap">
                                                    <ui-select-match placeholder="Filter Topic">
                                                        {{$select.selected.topicName}}
                                                    </ui-select-match>
                                                    <ui-select-choices repeat="topic in (class.topics|sort:{key:'topicName',mode:'ascending'}) | filter: { topicName: $select.search }">
                                                        <div ng-bind-html="topic.topicName | highlight: $select.search"></div>
                                                        <small class="text-muted" ng-bind-html="topic.topicDescription"></small>
                                                    </ui-select-choices>
                                                </ui-select>
                                                <span class="input-group-btn fullHeight">
                                                  <button type="button" ng-click="assessmentsQuery.topic = null" class="btn btn-default fullHeight" ng-disabled="!assessmentsQuery.topic">
                                                    <span class="glyphicon glyphicon-remove"></span>
                                                  </button>
                                                </span>
                                            </div>
                                            <div class="input-group" style="width:49%">
                                                <ui-select append-to-body="true" ng-model="assessmentsQuery.objective" theme="bootstrap" ng-disabled="!class.objectives.length">
                                                    <ui-select-match placeholder="Filter Objective">
                                                        {{$select.selected.objectiveText}}
                                                    </ui-select-match>
                                                    <ui-select-choices repeat="objective in (class.objectives|sort:{key:'objectiveText',mode:'ascending'}) | filter: { objectiveText: $select.search }">
                                                        <span ng-bind-html="objective.objectiveText | highlight: $select.search"></span>
                                                    </ui-select-choices>
                                                </ui-select>
                                                <span class="input-group-btn fullHeight">
                                                      <button type="button" ng-click="assessmentsQuery.objective = null" class="btn btn-default fullHeight" ng-disabled="!assessmentsQuery.objective">
                                                        <span class="glyphicon glyphicon-remove"></span>
                                                      </button>
                                                    </span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <!-- Bulk Dropdown -->
                                <div ng-if="classView.assessments.bulk.open">
                                    <div style="padding: 5px;background-color:#e7e7e7;border:1px solid rgb(205, 205, 205)">
                                        <div class="input-group" style="margin-right:2px">

                                            <div class="btn-group btn-group-sm" role="group" style="padding-right:5px">
                                                <button type="button" class="btn btn-default" ng-disabled="countAccordion('assessment',true) === class.assessments.length" ng-click="iterateAccordion('assessment',true,true)">Select All</button>
                                                <button type="button" class="btn btn-default" ng-disabled="countAccordion('assessment',true) === 0" ng-click="iterateAccordion('assessment',false,true)">Deselect All</button>
                                            </div>
                                            <div style="display:inline;padding-right:5px">{{countAccordion('assessment',true)}} selected</div>
                                            <div class="btn-group btn-group-sm" role="group">
                                                <button type="button" class="btn btn-danger" ng-disabled="!countAccordion('assessment',true)" ng-click="deleteAssessments(getAccordionIDs('assessment',true))">Delete</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div id="assessmentAccordionScroll" autoscroll="{{ 256 + (classView.assessments.filter.open?46:0) + (classView.assessments.bulk.open?46:0)}}" ng-scroll="floatingScrollListener('assessmentAccordionScroll')">
                                <div class="container-fluid" ng-if="!class.assessments.length">
                                    <h4 class="text-info">No Assessments</h4>
                                </div>
                                <div class="container-fluid" ng-if="class.assessments.length && !filterAssessments().length">
                                    <h4 class="text-info">No results, try adjusting your filters.</h4>
                                </div>

                                <uib-accordion close-others="false">
                                    <div uib-accordion-group class="panel-default" ng-repeat="assessment in (filterAssessments()|sort:getSortParams('assessments',classView.assessments.sort))" is-open="state.assessments.open[assessment.ID]" context-menu="assessmentHeader">
                                        <uib-accordion-heading>
                                            <div>
                                                <input class="bigCheckbox" type="checkbox" ng-model="state.assessments.checked[assessment.ID]" ng-if="classView.assessments.bulk.open" ng-click="$event.stopPropagation()"/>
                                                <span ng-bind-html="(classView.assessments.filter.open && classView.assessments.filter.searchNames)?(assessment.assessmentName|highlight:classView.assessments.filter.query:classView.assessments.filter.caseSensitive):assessment.assessmentName"></span>
                                                <span class="badge" ng-bind-html="assessmentTotalQuestions(assessment)"></span>
                                                <span class="badge" ng-if="assessment.rules.length" style="background-color:lightgrey">
                                                    {{ assessmentBadgeRules(assessment) }}
                                                </span>
                                                <span class="badge" ng-if="assessment.questions.length">
                                                    {{ assessmentBadgeQuestions(assessment) }}
                                                </span><br ng-if="assessment.assessmentDescription"/>
                                                <small ng-if="assessment.assessmentDescription" ng-bind-html="(classView.assessments.filter.open && classView.assessments.filter.searchDescriptions)?(assessment.assessmentDescription|highlight:classView.assessments.filter.query:classView.assessments.filter.caseSensitive):assessment.assessmentDescription">{{ assessment.assessmentDescription }}</small>
                                            </div>
                                        </uib-accordion-heading>

                                        <div class="btn-group btn-group-sm pull-right" role="group">
                                            <button type="button" class="btn btn-default" ng-click="editAssessment(assessment.ID)">Edit</button>
                                            <button type="button" class="btn btn-default" ng-click="exportAssessment(assessment.ID)">Export</button>
                                        </div>

                                        <!-- Rules -->
                                        <strong ng-if="assessment.rules.length">Rules:</strong>
                                        <p style="padding-left:5px" ng-repeat="rule in assessment.rules" bind-html-compile="formatAssessmentRule(rule)"></p>
                                        <!-- Manually Added Questions -->
                                        <strong ng-if="assessment.questions.length">Questions:</strong>
                                        <p style="padding-left:5px" ng-repeat="question in assessment.questions" bind-html-compile="formatAssessmentQuestion(question)"></p>

                                        <!-- No Rules or Questions -->
                                        <p class="text-info" ng-if="!assessment.questions.length && !assessment.rules.length">
                                            This assessment contains no rules or questions.
                                        </p>
                                    </div>
                                </uib-accordion>
                            </div>
                        </div>
                    </uib-tab>
                    <!-- Topics Tab-->
                    <uib-tab index="1" context-menu="topicsHeading">
                        <uib-tab-heading>
                            Topics  ({{ class.topics.length-1 }})
                        </uib-tab-heading>

                        <div class="tab-pane" style="padding:5px;background:white;border:1px solid #ddd;border-top-color:white;border-radius:0 0 4px 4px">
                            <div class="container-fluid" style="padding-bottom:5px">
                                <div id="topicFloatingButtons" style="padding-bottom:5px;">
                                    <div class="btn-group btn-group-sm" role="group">
                                        <button type="button" class="btn btn-primary" ng-click="createTopic()">Create New</button>
                                        <button type="button" class="btn btn-default" ng-disabled="!class.topics.length" ng-click="iterateAccordion('topic',true)">Expand All</button>
                                        <button type="button" class="btn btn-default" ng-disabled="!class.topics.length" ng-click="iterateAccordion('topic',false)">Collapse All</button>
                                    </div>

                                    <div class="btn-group btn-group-sm" style="float:right;position:relative;top:6px;display:flex">
                                        <ui-select ng-model="sortModels.topics" theme="bootstrap" search-enabled="false" uib-tooltip="Sorting Mode" style="width:190px">
                                            <ui-select-match style="height:30px;border-bottom-right-radius:0;border-top-right-radius:0;border-right:0">
                                                <span class="glyphicon" ng-class="$select.selected.icon" style="width:14px;left:-5px;font-size:12px"></span>{{$select.selected.name}}
                                            </ui-select-match>
                                            <ui-select-choices repeat="sort in sortModes">
                                                {{ sort.name }}
                                            </ui-select-choices>
                                        </ui-select>
                                        <button type="button" ng-class="'btn btn-default'+(classView.topics.bulk.open?' active':'')" data-toggle="button" tooltip-placement="top"
                                                uib-tooltip="Bulk Operations" ng-click="classView.topics.bulk.open = !classView.topics.bulk.open;">
                                            <span class="glyphicon glyphicon-check"></span>
                                        </button>
                                        <button type="button" ng-class="'btn btn-default'+(classView.topics.filter.open?' active':'')" data-toggle="button"
                                                tooltip-placement="top" uib-tooltip="Filter" ng-click="classView.topics.filter.open = !classView.topics.filter.open;focusId('filterTopicSearch')">
                                            <span class="glyphicon glyphicon-filter"></span>
                                        </button>
                                    </div>
                                </div>

                                <!-- Filter Dropdown -->
                                <div ng-if="classView.topics.filter.open">
                                    <div style="padding: 5px;background-color:#e7e7e7;border:1px solid rgb(205, 205, 205);display:inline-flex;width:100%">
                                        <div class="input-group" style="width:100%">
                                            <input type="text" class="form-control" placeholder="Filter Topics" id="filterTopicSearch" ng-model="classView.topics.filter.query">
                                            <span class="input-group-addon">
                                                <label>
                                                    <input type="checkbox" ng-model="classView.topics.filter.searchTopics" style="position:relative;top:2px"/>
                                                    Search Topics
                                                </label>
                                                <label>
                                                    <input type="checkbox" ng-model="classView.topics.filter.searchDescriptions" style="position:relative;top:2px"/>
                                                    Search Descriptions
                                                </label>
                                                <label>
                                                    <input type="checkbox" ng-model="classView.topics.filter.caseSensitive" style="position:relative;top:2px"/>
                                                    Case Sensitive
                                                </label>
                                            </span>
                                        </div>
                                    </div>
                                </div>
                                <!-- Bulk Dropdown -->
                                <div ng-if="classView.topics.bulk.open">
                                    <div style="padding: 5px;background-color:#e7e7e7;border:1px solid rgb(205, 205, 205)">
                                        <div class="input-group" style="margin-right:2px">

                                            <div class="btn-group btn-group-sm" role="group" style="padding-right:5px">
                                                <button type="button" class="btn btn-default" ng-disabled="countAccordion('topic',true) === class.topics.length" ng-click="iterateAccordion('topic',true,true)">Select All</button>
                                                <button type="button" class="btn btn-default" ng-disabled="countAccordion('topic',true) === 0" ng-click="iterateAccordion('topic',false,true)">Deselect All</button>
                                            </div>
                                            <div style="display:inline;padding-right:5px">{{countAccordion('topic',true)}} selected</div>
                                            <div class="btn-group btn-group-sm" role="group">
                                                <button type="button" class="btn btn-danger" ng-disabled="!countAccordion('topic',true)" ng-click="deleteTopics(getAccordionIDs('topic',true))">Delete</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div id="topicAccordionScroll" autoscroll="{{ 256 + (classView.topics.filter.open?46:0) + (classView.topics.bulk.open?46:0)}}" ng-scroll="floatingScrollListener('topicAccordionScroll')">
                                <div class="container-fluid" ng-if="!class.topics.length">
                                    <h4 class="text-info">No Topics</h4>
                                </div>
                                <div class="container-fluid" ng-if="class.topics.length && !filterTopics().length">
                                    <h4 class="text-info">No results, try adjusting your filters.</h4>
                                </div>

                                <uib-accordion close-others="false">
                                    <div uib-accordion-group class="panel-default" ng-repeat="topic in (filterTopics()|sort:getSortParams('topics',classView.topics.sort))" is-open="state.topics.open[topic.ID]" context-menu="topicHeader">
                                        <uib-accordion-heading>
                                            <div>
                                                <input class="bigCheckbox" type="checkbox" ng-model="state.topics.checked[topic.ID]" ng-if="classView.topics.bulk.open" ng-click="$event.stopPropagation()"/>
                                                <span ng-bind-html="(classView.topics.filter.open && classView.topics.filter.searchTopics)?(topic.topicName|highlight:classView.topics.filter.query:classView.topics.filter.caseSensitive):topic.topicName"></span>
                                                <span class="badge">
                                                    {{ topicBadge(topic) }}
                                                </span>
                                                <span class="badge" ng-if="topic.ID == 0" tooltip-placement="right"
                                                      uib-tooltip="Questions without a set topic will be assigned this topic">
                                                    Default Topic
                                                </span>
                                                <br ng-if="topic.topicDescription" />
                                                <small ng-if="topic.topicDescription" ng-bind-html="(classView.topics.filter.open && classView.topics.filter.searchDescriptions)?(topic.topicDescription|highlight:classView.topics.filter.query:classView.topics.filter.caseSensitive):topic.topicDescription"></small>
                                            </div>
                                        </uib-accordion-heading>

                                        <div class="btn-group btn-group-sm pull-right" role="group">
                                            <button type="button" class="btn btn-default" ng-click="editTopic(topic.ID)">Edit</button>
                                        </div>

                                        <!-- Questions -->
                                        <strong ng-if="topic.questions.length">Questions:</strong>
                                        <p style="padding-left:5px" ng-repeat="question in (topic.questions|sort:{key:'questionTitle',mode:'ascending'})" bind-html-compile="formatQuestion(question)"></p>

                                        <!-- No Questions -->
                                        <p class="text-info" ng-if="!topic.questions.length">
                                            There are no questions under this topic.
                                        </p>
                                    </div>
                                </uib-accordion>
                            </div>
                        </div>
                    </uib-tab>
                    <!-- Objectives Tab -->
                    <uib-tab index="2" context-menu="objectivesHeading">
                        <uib-tab-heading>
                            Objectives  ({{ class.objectives.length }})
                        </uib-tab-heading>

                        <div class="tab-pane" style="padding:5px;background:white;border:1px solid #ddd;border-top-color:white;border-radius:0 0 4px 4px">
                            <div class="container-fluid" style="padding-bottom:5px">
                                <div id="objectiveFloatingButtons" style="padding-bottom:5px;">
                                    <div class="btn-group btn-group-sm" role="group">
                                        <button type="button" class="btn btn-primary" ng-click="createObjective()">Create New</button>
                                        <button type="button" class="btn btn-default" ng-disabled="!class.objectives.length" ng-click="iterateAccordion('objective',true)">Expand All</button>
                                        <button type="button" class="btn btn-default" ng-disabled="!class.objectives.length" ng-click="iterateAccordion('objective',false)">Collapse All</button>
                                    </div>

                                    <div class="btn-group btn-group-sm" style="float:right;position:relative;top:6px;display:flex">
                                        <ui-select ng-model="sortModels.objectives" theme="bootstrap" search-enabled="false" uib-tooltip="Sorting Mode" style="width:190px"">
                                            <ui-select-match style="height:30px;border-bottom-right-radius:0;border-top-right-radius:0;border-right:0">
                                                <span class="glyphicon" ng-class="$select.selected.icon" style="width:14px;left:-5px;font-size:12px"></span>{{$select.selected.name}}
                                            </ui-select-match>
                                            <ui-select-choices repeat="sort in sortModes">
                                                {{ sort.name }}
                                            </ui-select-choices>
                                        </ui-select>
                                        <button type="button" ng-class="'btn btn-default'+(classView.objectives.bulk.open?' active':'')" data-toggle="button" tooltip-placement="top"
                                                uib-tooltip="Bulk Operations" ng-click="classView.objectives.bulk.open = !classView.objectives.bulk.open;">
                                            <span class="glyphicon glyphicon-check"></span>
                                        </button>
                                        <button type="button" ng-class="'btn btn-default'+(classView.objectives.filter.open?' active':'')" data-toggle="button"
                                                tooltip-placement="top" uib-tooltip="Filter" ng-click="classView.objectives.filter.open = !classView.objectives.filter.open;focusId('filterObjectiveSearch')">
                                            <span class="glyphicon glyphicon-filter"></span>
                                        </button>
                                    </div>
                                </div>

                                <!-- Filter Dropdown -->
                                <div ng-if="classView.objectives.filter.open">
                                    <div style="padding: 5px;background-color:#e7e7e7;border:1px solid rgb(205, 205, 205);display:inline-flex;width:100%">
                                        <div class="input-group" style="width:100%">
                                            <input type="text" class="form-control" placeholder="Filter Objectives" id="filterObjectiveSearch" ng-model="classView.objectives.filter.query">
                                            <span class="input-group-addon">
                                                <label>
                                                    <input type="checkbox" ng-model="classView.objectives.filter.caseSensitive" style="position:relative;top:2px"/>
                                                    Case Sensitive
                                                </label>
                                            </span>
                                        </div>
                                    </div>
                                </div>
                                <!-- Bulk Dropdown -->
                                <div ng-if="classView.objectives.bulk.open">
                                    <div style="padding: 5px;background-color:#e7e7e7;border:1px solid rgb(205, 205, 205)">
                                        <div class="input-group" style="margin-right:2px">

                                            <div class="btn-group btn-group-sm" role="group" style="padding-right:5px">
                                                <button type="button" class="btn btn-default" ng-disabled="countAccordion('objective',true) === class.objectives.length" ng-click="iterateAccordion('objective',true,true)">Select All</button>
                                                <button type="button" class="btn btn-default" ng-disabled="countAccordion('objective',true) === 0" ng-click="iterateAccordion('objective',false,true)">Deselect All</button>
                                            </div>
                                            <div style="display:inline;padding-right:5px">{{countAccordion('objective',true)}} selected</div>
                                            <div class="btn-group btn-group-sm" role="group">
                                                <button type="button" class="btn btn-danger" ng-disabled="!countAccordion('objective',true)" ng-click="deleteObjectives(getAccordionIDs('objective',true))">Delete</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div id="objectiveAccordionScroll" autoscroll="{{ 256 + (classView.objectives.filter.open?46:0) + (classView.objectives.bulk.open?46:0) }}" ng-scroll="floatingScrollListener('objectiveAccordionScroll')">
                                <div class="container-fluid" ng-if="!class.objectives.length">
                                    <h4 class="text-info">No Objectives</h4>
                                </div>
                                <div class="container-fluid" ng-if="class.objectives.length && !filterObjectives().length">
                                    <h4 class="text-info">No results, try adjusting your filters.</h4>
                                </div>

                                <uib-accordion close-others="false">
                                    <div uib-accordion-group class="panel-default" ng-repeat="objective in (filterObjectives()|sort:getSortParams('objectives',classView.objectives.sort))" is-open="state.objectives.open[objective.ID]" context-menu="objectiveHeader">
                                        <uib-accordion-heading>
                                            <div>
                                                <input class="bigCheckbox" type="checkbox" ng-model="state.objectives.checked[objective.ID]" ng-if="classView.objectives.bulk.open" ng-click="$event.stopPropagation()"/>
                                                <span ng-bind-html="classView.objectives.filter.open?(objective.objectiveText | highlight: classView.objectives.filter.query:classView.objectives.filter.caseSensitive):(objective.objectiveText)"></span>
                                                <span class="badge">
                                                    {{ objectiveBadge(objective) }}
                                                </span><br/>
                                            </div>
                                        </uib-accordion-heading>

                                        <div class="btn-group btn-group-sm pull-right" role="group">
                                            <button type="button" class="btn btn-default" ng-click="editObjective(objective.ID)">Edit</button>
                                        </div>

                                        <!-- Questions -->
                                        <strong ng-if="objective.questionUIDs.length">Questions:</strong>
                                        <div bind-html-compile="formatObjectiveQuestions(objective)"></div>

                                        <!-- No Questions -->
                                        <p class="text-info" ng-if="!objective.questionUIDs.length">
                                            There are no questions under this objective.
                                        </p>

                                    </div>
                                </uib-accordion>
                            </div>
                        </div>
                    </uib-tab>
                    <!-- Questions Tab -->
                    <uib-tab index="3" context-menu="questionsHeading">
                        <uib-tab-heading>
                            Questions  ({{ getClassQuestions() }})
                        </uib-tab-heading>

                        <div class="tab-pane" style="padding:5px;background:white;border:1px solid #ddd;border-top-color:white;border-radius:0 0 4px 4px">
                            <div class="container-fluid" style="padding-bottom:5px">
                                <div id="questionFloatingButtons" style="padding-bottom:5px;">
                                    <div class="btn-group btn-group-sm" role="group">
                                        <button type="button" class="btn btn-primary" ng-click="createQuestion()">Create New</button>
                                        <button type="button" class="btn btn-default" ng-disabled="!questionCount" ng-click="iterateAccordion('question',true)">Expand All</button>
                                        <button type="button" class="btn btn-default" ng-disabled="!questionCount" ng-click="iterateAccordion('question',false)">Collapse All</button>
                                    </div>

                                    <div class="btn-group btn-group-sm" style="float:right;position:relative;top:6px; display: flex">
                                        <ui-select ng-model="sortModels.questions" theme="bootstrap" search-enabled="false" uib-tooltip="Sorting Mode" style="width:190px">
                                            <ui-select-match style="height:30px;border-bottom-right-radius:0;border-top-right-radius:0;border-right:0">
                                                <span class="glyphicon" ng-class="$select.selected.icon" style="width:14px;left:-5px;font-size:12px"></span>{{$select.selected.name}}
                                            </ui-select-match>
                                            <ui-select-choices repeat="sort in sortModes">
                                                {{ sort.name }}
                                            </ui-select-choices>
                                        </ui-select>
                                        <button type="button" ng-class="'btn btn-default'+(classView.questions.bulk.open?' active':'')" data-toggle="button" tooltip-placement="top"
                                                uib-tooltip="Bulk Operations" ng-click="classView.questions.bulk.open = !classView.questions.bulk.open;">
                                            <span class="glyphicon glyphicon-check"></span>
                                        </button>
                                        <button type="button" ng-class="'btn btn-default'+(classView.questions.filter.open?' active':'')" data-toggle="button"
                                                tooltip-placement="top" uib-tooltip="Filter" ng-click="classView.questions.filter.open = !classView.questions.filter.open;focusId('filterQuestionSearch')">
                                            <span class="glyphicon glyphicon-filter"></span>
                                        </button>
                                    </div>
                                </div>

                                <!-- Filter Dropdown -->
                                <div ng-if="classView.questions.filter.open">
                                    <div style="padding: 5px;background-color:#e7e7e7;border:1px solid rgb(205, 205, 205);display:flex;flex-flow:row wrap;">
                                        <div class="input-group" style="width:65%;margin-right:2px;flex:1 1 auto;display:flex">
                                            <input type="text" class="form-control" placeholder="Filter Questions" id="filterQuestionSearch" ng-model="classView.questions.filter.query" style="flex:1 1 auto;">
                                            <span class="input-group-addon" style="min-width:46%; white-space: normal; flex:1 1 auto;">
                                                <label>
                                                    <input type="checkbox" ng-model="classView.questions.filter.searchQuestions" style="position:relative;top:2px"/>
                                                    Search Questions
                                                </label>

                                                <label>
                                                    <input type="checkbox" ng-model="classView.questions.filter.searchDescriptions" style="position:relative;top:2px"/>
                                                    Search Descriptions
                                                </label>

                                                <label>
                                                    <input type="checkbox" ng-model="classView.questions.filter.searchAnswers" style="position:relative;top:2px"/>
                                                    Search Answers
                                                </label>

                                                <label>
                                                    <input type="checkbox" ng-model="classView.questions.filter.caseSensitive" style="position:relative;top:2px"/>
                                                    Case Sensitive
                                                </label>
                                            </span>
                                        </div>
                                        <div style="width:34.8%; display:inherit;flex:1 1 auto;overflow-x:auto">
                                            <div class="input-group" style="width:49%;margin-right:2px">
                                                <ui-select append-to-body="true" allow-clear ng-model="questionsQuery.topic" theme="bootstrap">
                                                    <ui-select-match placeholder="Filter Topic">
                                                        {{$select.selected.topicName}}
                                                    </ui-select-match>
                                                    <ui-select-choices repeat="topic in (class.topics|sort:{key:'topicName',mode:'ascending'}) | filter: { topicName: $select.search }">
                                                        <div ng-bind-html="topic.topicName | highlight: $select.search"></div>
                                                        <small class="text-muted" ng-bind-html="topic.topicDescription"></small>
                                                    </ui-select-choices>
                                                </ui-select>
                                                <span class="input-group-btn fullHeight">
                                                  <button type="button" ng-click="questionsQuery.topic = null" class="btn btn-default fullHeight" ng-disabled="!questionsQuery.topic">
                                                    <span class="glyphicon glyphicon-remove"></span>
                                                  </button>
                                                </span>
                                            </div>
                                            <div class="input-group" style="width:49%">
                                                <ui-select append-to-body="true" ng-model="questionsQuery.objective" theme="bootstrap" ng-disabled="!class.objectives.length">
                                                    <ui-select-match placeholder="Filter Objective">
                                                        {{$select.selected.objectiveText}}
                                                    </ui-select-match>
                                                    <ui-select-choices repeat="objective in (class.objectives|sort:{key:'objectiveText',mode:'ascending'}) | filter: { objectiveText: $select.search }">
                                                        <span ng-bind-html="objective.objectiveText | highlight: $select.search"></span>
                                                    </ui-select-choices>
                                                </ui-select>
                                                <span class="input-group-btn fullHeight">
                                                  <button type="button" ng-click="questionsQuery.objective = null" class="btn btn-default fullHeight" ng-disabled="!questionsQuery.objective">
                                                    <span class="glyphicon glyphicon-remove"></span>
                                                  </button>
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Bulk Dropdown -->
                                <div ng-if="classView.questions.bulk.open">
                                    <div style="padding: 5px;background-color:#e7e7e7;border:1px solid rgb(205, 205, 205)">
                                        <div class="input-group" style="margin-right:2px">

                                            <div class="btn-group btn-group-sm" role="group" style="padding-right:5px">
                                                <button type="button" class="btn btn-default" ng-disabled="countAccordion('question',true) === questionCount" ng-click="iterateAccordion('question',true,true)">Select All</button>
                                                <button type="button" class="btn btn-default" ng-disabled="countAccordion('question',true) === 0" ng-click="iterateAccordion('question',false,true)">Deselect All</button>
                                            </div>
                                            <div style="display:inline;padding-right:5px">{{countAccordion('question',true)}} selected</div>
                                            <div class="btn-group btn-group-sm" role="group">
                                                <button type="button" class="btn btn-danger" ng-disabled="!countAccordion('question',true)" ng-click="deleteQuestions(getAccordionIDs('question',true))">Delete</button>
                                                <button type="button" class="btn btn-primary" ng-disabled="!countAccordion('question',true)" ng-click="changeTopics(getAccordionIDs('question',true))">Change Topic</button>
                                                <button type="button" class="btn btn-primary" ng-disabled="!class.objectives.length||!countAccordion('question',true)" ng-click="addObjectives(getAccordionIDs('question',true))">Add Objective</button>
                                                <button type="button" class="btn btn-primary" ng-disabled="!class.objectives.length||!countAccordion('question',true)" ng-click="removeObjectives(getAccordionIDs('question',true))">Remove Objective</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div id="questionAccordionScroll" autoscroll="{{ 256 + (classView.questions.filter.open?46:0) + (classView.questions.bulk.open?46:0) }}" ng-scroll="floatingScrollListener('questionAccordionScroll')"
                                 style="margin: 0 5px 0 5px">
                                <div class="container-fluid" ng-if="!questionCount">
                                    <h4 class="text-info">No Questions</h4>
                                </div>
                                <div class="container-fluid" ng-if="questionCount && !filterQuestions().length">
                                    <h4 class="text-info">No results, try adjusting your filters.</h4>
                                </div>

                                <uib-accordion close-others="false">
                                    <div uib-accordion-group class="panel-default" ng-repeat="question in (filterQuestions()|sort:getSortParams('questions',classView.questions.sort))" is-open="state.questions.open[UIDtoJson(question.UID)]" context-menu="questionHeader" template-url="html/accordion-group.html">
                                        <uib-accordion-heading>
                                            <div>
                                                <input class="bigCheckbox" type="checkbox" ng-model="state.questions.checked[UIDtoJson(question.UID)]" ng-if="classView.questions.bulk.open" ng-click="$event.stopPropagation()"/>
                                                <span ng-bind-html="(classView.questions.filter.searchQuestions && classView.questions.filter.open)?(question.questionTitle | highlight: classView.questions.filter.query:classView.questions.filter.caseSensitive):(question.questionTitle)"></span>
                                                <span class="badge" ng-if="question.topicID != 0">
                                                    {{ questionBadgeTopic(question) }}
                                                </span>
                                                <span class="badge" ng-if="question.objectives.length">
                                                    {{ questionBadgeObjectives(question) }}
                                                </span><br ng-if="question.questionDescription"/>
                                                <small ng-if="question.questionDescription" ng-bind-html="(classView.questions.filter.searchDescriptions && classView.questions.filter.open)?(question.questionDescription | highlight: classView.questions.filter.query:classView.questions.filter.caseSensitive):(question.questionDescription)"></small>
                                            </div>
                                        </uib-accordion-heading>

                                        <div class="btn-group btn-group-sm pull-right" role="group">
                                            <button type="button" class="btn btn-default" ng-click="editQuestion(question.UID)">Edit</button>
                                        </div>

                                        <!-- Question Topic and Objectives -->
                                        <p bind-html-compile="formatQuestionTopicObjectives(question)"></p>

                                        <!-- Question Type -->
                                        <strong bind-html-compile="formatQuestionType(question)"></strong>

                                        <!-- Answers -->
                                        <p style="padding-left:5px" ng-if="question.answers" ng-bind-html="formatQuestionAnswers(question)"></p>

                                        <!-- No Answers -->
                                        <p class="text-info" ng-if="!question.answers">
                                            This question has no answers.
                                        </p>
                                    </div>
                                </uib-accordion>
                            </div>
                        </div>
                    </uib-tab>
                </uib-tabset>
            </div>
        </div>
    </div>

    <!-- Other Tabs -->
    <div ng-repeat="tab in tabs" label="{{ tab.name }}" ng-show="currentTab === tab.id">
        <div class="padding greyBackground">
            <div ng-include="tab.URL" dynamic-ctrl="tab.controller"
                 ng-init="tabID=tab.id;tabData=tab.data;requestFocus()"></div>
        </div>
    </div>

</div>